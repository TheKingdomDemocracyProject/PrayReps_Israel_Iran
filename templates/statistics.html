{% extends "base.html" %}

{% block title %}Statistics - {{ country_name }}{% endblock %}

{% block page_title %}Statistics for {{ country_name }}{% endblock %}

{% block head_extra %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script>
        // Pass data from Flask to JavaScript
        const currentCountryCode = {{ country_code | tojson | safe }};
        const currentCountryName = {{ country_name | tojson | safe }};
        // current_country_party_info_json is passed from the Python route
        const partyInfoForCountryJS = JSON.parse({{ current_country_party_info_json | tojson | safe }});
    </script>
{% endblock %}

{% block content %}
    <div class="statscontent content-container">
        {# Main navigation links are in base.html header #}
        <div class="country-switch-links">
            Switch to:
            <a href="{{ url_for('stats.statistics_page', country_code='overall') }}">Overall Statistics</a>
            {% for code, config_data in all_countries_config.items() %} {# Use all_countries_config from context processor #}
                {% if code != country_code %}
                    <a href="{{ url_for('stats.statistics_page', country_code=code) }}">{{ config_data.name }} Statistics</a>
                {% endif %}
            {% endfor %}
        </div>
        <div class="statistics">
            <canvas id="timeChart"></canvas>
        </div>
        <div class="party-counts">
            {% for party_short_name, count in sorted_party_counts %}
            {# party_short_name is already the short name from app.py context #}
            <div class="party-block {{ party_short_name | lower | replace(' ', '-') | replace('&', 'and') }}">
                {{ party_short_name }}: {{ count }}
            </div>
            {% endfor %}
        </div>
        <div class="statistics">
            <canvas id="partyChart"></canvas>
        </div>
    </div>
</body>
</html>
